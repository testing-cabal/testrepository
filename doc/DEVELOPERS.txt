Development guidelines for Test Repository
++++++++++++++++++++++++++++++++++++++++++

Coding style
~~~~~~~~~~~~

PEP-8 please. We don't enforce a particular style, but being reasonably 
consistent aids readability.

Copyrights and licensing
~~~~~~~~~~~~~~~~~~~~~~~~

Code committed to Test Repository must be licensed under the BSD + Apache-2.0
licences that Test Repository offers its users. Copyright assignment is not
required. Please see COPYING for details about how to make a license grant in
a given source file. Lastly, all copyright holders need to add their name
to the master list in COPYING the first time they make a change in a given
calendar year.

Testing and QA
~~~~~~~~~~~~~~

For Test repository please add tests where possible. There is no requirement
for one test per change (because somethings are much harder to automatically
test than the benfit from such tests). Fast tests are preferred to slow tests,
and understandable tests to fast tests.

http://build.robertcollins.net/ has a job testing every commit made to trunk
of Test Repository, and there is no automated test-before-merge process at the
moment. The quid pro quo for committers is that they should check that the
automated job found their change acceptable after merging it, and either roll
it back or fix it immediately. A broken trunk is not acceptable!

See DESIGN.txt for information about code layout which will help you find
where to add tests (and indeed where to change things).

Running the tests
-----------------

Generally just ``make`` is all that is needed to run all the tests. However
if dropping into pdb, it is currently more convenient to use
``python -m testtools.run discover``.

The tools in ``tools/`` can run up lxc containers to run different versions of
Python transparently using the in-built profile support. Some local
configuration is needed - creating virtualenvs with names that inform the
tools of the container name to use. The profile 'DEFAULT' will bypass the
container glue and run in the local environment.

Specifically, the current scripts assume virtualenvs in ~/.virtualenvs (like
virtualenv-wrappers creates), and a name of testrepository-$profile-hostname,
with 'ssh hostname' being something that works.

So to run the full test matrix for testrepository, create one lxc container
for each Linux distribution you need in order to have Python 2.6, 2.7, 3.2,
3.3, 3.4, 3.5, cpython(e.g. master), pypy and pypy3, and then create one
virtualenv for each of the versions to test in ~/.virtualenvs, named
testrepository-$version-$lxchostname. Finally, run `testr run`.

Diagnosing issues
-----------------

The cli UI will drop into pdb when an error is thrown if TESTR_PDB is set in
the environment. This can be very useful for diagnosing problems.

Releasing
---------

Update NEWS and testrepository/__init__.py version numbers. Release to pypi.
Pivot the next milestone on LP to version, and make a new next milestone.
Make a new tag and push that to github.
